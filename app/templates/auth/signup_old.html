{% extends "base.html" %}

{% block title %}Sign Up - CommUnity{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center py-8 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-slate-50 via-blue-50 to-slate-100 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
    <div class="max-w-2xl w-full">
        <!-- Back Button -->
        <a href="{{ url_for('main.landing') }}" class="inline-flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors mb-6">
            <span class="material-symbols-outlined text-[20px]">arrow_back</span>
            <span class="text-sm font-medium">Back to home</span>
        </a>

        <!-- Signup Card -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl overflow-hidden">
            <!-- Hero Image -->
            <div class="relative h-40 sm:h-48 bg-gradient-to-br from-blue-500 via-primary to-purple-600 overflow-hidden">
                <div class="absolute inset-0 bg-black/10"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-center">
                        <div class="w-20 h-20 sm:w-24 sm:h-24 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center mx-auto mb-3">
                            <span class="material-symbols-outlined text-white text-5xl sm:text-6xl">group_add</span>
                        </div>
                        <h1 class="text-white text-2xl sm:text-3xl font-bold">Join the Network</h1>
                        <p class="text-white/90 text-sm sm:text-base mt-1">Connect with people who share your interests</p>
                    </div>
                </div>
                <!-- Decorative circles -->
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full"></div>
                <div class="absolute -bottom-16 -left-16 w-48 h-48 bg-white/10 rounded-full"></div>
                <!-- Login Link -->
                <a href="{{ url_for('auth.login') }}" class="absolute top-4 right-4 text-white/90 hover:text-white text-sm font-semibold flex items-center gap-1 transition-colors">
                    <span>Log In</span>
                    <span class="material-symbols-outlined text-[18px]">arrow_forward</span>
                </a>
            </div>

            <!-- Form Container -->
            <div class="p-6 sm:p-8">
                <!-- Flash Messages -->
                <div id="flash-messages" class="mb-4"></div>

                <!-- Form Section -->
                <form id="signup-form" class="space-y-5">
                <!-- Form Section -->
                <form id="signup-form" class="space-y-5">
                    <!-- Name Input -->
                    <div class="space-y-2">
                        <label class="text-slate-700 dark:text-slate-300 text-sm font-semibold" for="name">Full Name</label>
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">person</span>
                            <input 
                                class="w-full h-12 sm:h-14 pl-12 pr-4 rounded-xl text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/30 border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 placeholder:text-slate-400 text-base transition-all" 
                                id="name" 
                                placeholder="e.g. Alex Morgan" 
                                type="text" 
                                required
                            />
                        </div>
                    </div>

                    <!-- Email Input -->
                    <div class="space-y-2">
                        <label class="text-slate-700 dark:text-slate-300 text-sm font-semibold" for="email">Email Address</label>
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">mail</span>
                            <input 
                                class="w-full h-12 sm:h-14 pl-12 pr-4 rounded-xl text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/30 border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 placeholder:text-slate-400 text-base transition-all" 
                                id="email" 
                                placeholder="name@example.com" 
                                type="email" 
                                required
                            />
                        </div>
                    </div>

                    <!-- Password Input -->
                    <div class="space-y-2">
                        <label class="text-slate-700 dark:text-slate-300 text-sm font-semibold" for="password">Password</label>
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">lock</span>
                            <input 
                                class="w-full h-12 sm:h-14 pl-12 pr-12 rounded-xl text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/30 border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 placeholder:text-slate-400 text-base transition-all" 
                                id="password" 
                                placeholder="Create a password" 
                                type="password" 
                                required 
                                minlength="6"
                            />
                            <button type="button" id="toggle-password" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-primary transition-colors">
                                <span class="material-symbols-outlined text-[20px]">visibility</span>
                            </button>
                        </div>
                    </div>

                    <!-- Phone Number (Optional) -->
                    <div class="space-y-2">
                        <label class="text-slate-700 dark:text-slate-300 text-sm font-semibold" for="phone">Phone Number (Optional)</label>
                        <div class="flex gap-2">
                            <select id="country-code" class="w-28 sm:w-32 h-12 sm:h-14 px-2 sm:px-3 rounded-xl bg-slate-50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/30 transition-all text-sm sm:text-base">
                                <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                                <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
                                <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
                                <option value="+86">ðŸ‡¨ðŸ‡³ +86</option>
                                <option value="+81">ðŸ‡¯ðŸ‡µ +81</option>
                                <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
                                <option value="+33">ðŸ‡«ðŸ‡· +33</option>
                                <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
                                <option value="+82">ðŸ‡°ðŸ‡· +82</option>
                                <option value="+234">ðŸ‡³ðŸ‡¬ +234</option>
                                <option value="+27">ðŸ‡¿ðŸ‡¦ +27</option>
                                <option value="+55">ðŸ‡§ðŸ‡· +55</option>
                                <option value="+52">ðŸ‡²ðŸ‡½ +52</option>
                                <option value="+7">ðŸ‡·ðŸ‡º +7</option>
                                <option value="+39">ðŸ‡®ðŸ‡¹ +39</option>
                                <option value="+34">ðŸ‡ªðŸ‡¸ +34</option>
                            </select>
                            <div class="relative flex-1">
                                <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">phone</span>
                                <input 
                                    class="w-full h-12 sm:h-14 pl-12 pr-4 rounded-xl text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/30 border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 placeholder:text-slate-400 text-base transition-all" 
                                    id="phone" 
                                    placeholder="234 567 8900" 
                                    type="tel"
                                />
                            </div>
                        </div>
                    </div>

                    <!-- Location Input -->
                    <div class="space-y-2">
                        <label class="text-slate-700 dark:text-slate-300 text-sm font-semibold" for="location">Location</label>
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">location_on</span>
                            <input 
                                class="w-full h-12 sm:h-14 pl-12 pr-14 rounded-xl text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/30 border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 placeholder:text-slate-400 text-base transition-all" 
                                id="location" 
                                placeholder="City or Region" 
                                type="text"
                            />
                            <button type="button" id="get-location" class="absolute right-3 top-1/2 -translate-y-1/2 h-8 px-2 flex items-center justify-center text-primary hover:bg-primary/10 rounded-lg transition-colors" title="Use my location">
                                <span class="material-symbols-outlined text-[20px]">my_location</span>
                            </button>
                        </div>
                        <p class="text-xs text-slate-500 dark:text-slate-400">Click the location icon to auto-detect your location</p>
                    </div>

                    <!-- Interests Selection -->
                    <!-- Interests Selection -->
                    <div class="space-y-2.5 mt-2">
                        <label class="text-slate-700 dark:text-slate-300 text-sm font-semibold">Your Interests</label>
                        
                        <!-- Search/Add Interest Input -->
                        <div class="relative">
                            <input 
                                type="text" 
                                id="interest-search" 
                                placeholder="Type to search or add interests..."
                                class="w-full h-12 sm:h-14 px-4 pr-12 rounded-xl text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/30 border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 placeholder:text-slate-400 text-base transition-all"
                            />
                            <span class="material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px] pointer-events-none">search</span>
                            
                            <!-- Suggestions Dropdown -->
                            <div id="interest-suggestions" class="hidden absolute z-10 w-full mt-1 max-h-60 overflow-y-auto bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl shadow-lg">
                                <!-- Suggestions will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Common Interests Quick Select -->
                        <div class="flex flex-wrap gap-2" id="common-interests">
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Technology">
                                Technology
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Sports">
                                Sports
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Music">
                                Music
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Art">
                                Art
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Food">
                                Food
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Travel">
                                Travel
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Reading">
                                Reading
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Photography">
                                Photography
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Gaming">
                                Gaming
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Fitness">
                                Fitness
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Volunteering">
                                Volunteering
                            </button>
                            <button type="button" class="common-interest-btn px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 text-sm font-medium hover:border-primary/50 hover:text-primary transition-all" data-interest="Movies">
                                Movies
                            </button>
                        </div>
                        
                        <!-- Selected Interests -->
                        <div id="selected-interests" class="flex flex-wrap gap-2 min-h-[40px]">
                            <!-- Selected interests will appear here -->
                        </div>
                        
                        <!-- Hidden input to store selected interests -->
                        <input type="hidden" id="interests-data" name="interests" value="[]">
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button id="signup-btn" class="w-full h-12 sm:h-14 flex items-center justify-center rounded-xl bg-primary text-white text-base font-bold shadow-lg shadow-primary/25 hover:bg-blue-600 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed" type="submit">
                            <span id="btn-text">Create Account</span>
                            <span id="btn-icon" class="material-symbols-outlined text-[20px] ml-2">arrow_forward</span>
                            <svg id="btn-loading" class="animate-spin h-5 w-5 text-white hidden ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Footer / Legal -->
                    <p class="text-center text-xs text-slate-500 dark:text-slate-400 mt-4 leading-relaxed">
                        By signing up, you agree to our <a class="underline hover:text-primary" href="#">Terms of Service</a> and <a class="underline hover:text-primary" href="#">Privacy Policy</a>.
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Comprehensive interest list
    const allInterests = [
        'Technology', 'Programming', 'Web Development', 'Mobile Apps', 'AI & Machine Learning', 'Data Science',
        'Cybersecurity', 'Blockchain', 'Gaming', 'Virtual Reality',
        'Sports', 'Football', 'Basketball', 'Tennis', 'Swimming', 'Yoga', 'Fitness', 'Running', 'Cycling', 'Hiking',
        'Art', 'Painting', 'Drawing', 'Sculpture', 'Photography', 'Digital Art', 'Graphic Design',
        'Music', 'Guitar', 'Piano', 'Singing', 'DJing', 'Music Production', 'Concert Going',
        'Volunteering', 'Community Service', 'Environmental Conservation', 'Animal Welfare', 'Teaching',
        'Food', 'Cooking', 'Baking', 'Wine Tasting', 'Coffee', 'Restaurants', 'Veganism', 'Food Photography',
        'Travel', 'Backpacking', 'Road Trips', 'Cultural Exchange', 'Adventure Travel',
        'Reading', 'Writing', 'Poetry', 'Blogging', 'Journalism', 'Book Clubs',
        'Movies', 'TV Shows', 'Theater', 'Stand-up Comedy', 'Film Making',
        'Fashion', 'Beauty', 'Makeup', 'Styling', 'Sustainable Fashion',
        'Business', 'Entrepreneurship', 'Marketing', 'Finance', 'Real Estate', 'Investing',
        'Education', 'Languages', 'History', 'Science', 'Philosophy', 'Psychology',
        'Gardening', 'Urban Farming', 'Sustainability', 'DIY Projects', 'Woodworking', 'Crafts',
        'Pets', 'Dogs', 'Cats', 'Bird Watching', 'Aquariums',
        'Meditation', 'Mindfulness', 'Spirituality', 'Self-improvement', 'Mental Health'
    ];
    
    let selectedInterests = [];
    
    // Password visibility toggle
    document.getElementById('toggle-password').addEventListener('click', function() {
        const passwordInput = document.getElementById('password');
        const icon = this.querySelector('.material-symbols-outlined');
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.textContent = 'visibility_off';
        } else {
            passwordInput.type = 'password';
            icon.textContent = 'visibility';
        }
    });
    
    // Get user location
    document.getElementById('get-location').addEventListener('click', function() {
        const btn = this;
        const icon = btn.querySelector('.material-symbols-outlined');
        const locationInput = document.getElementById('location');
        
        // Show loading state
        icon.textContent = 'progress_activity';
        icon.classList.add('animate-spin');
        btn.disabled = true;
        
        if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const { latitude, longitude } = position.coords;
                    
                    try {
                        // Use reverse geocoding API to get city name
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                        const data = await response.json();
                        
                        const city = data.address.city || data.address.town || data.address.village || data.address.county;
                        const country = data.address.country;
                        
                        locationInput.value = `${city}, ${country}`;
                        showMessage('Location detected successfully!', 'success');
                    } catch (error) {
                        locationInput.value = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                        showMessage('Location detected (coordinates)', 'success');
                    }
                    
                    // Reset button
                    icon.textContent = 'my_location';
                    icon.classList.remove('animate-spin');
                    btn.disabled = false;
                },
                (error) => {
                    showMessage('Unable to access location. Please enter manually.', 'error');
                    icon.textContent = 'my_location';
                    icon.classList.remove('animate-spin');
                    btn.disabled = false;
                }
            );
        } else {
            showMessage('Geolocation is not supported by your browser', 'error');
            icon.textContent = 'my_location';
            icon.classList.remove('animate-spin');
            btn.disabled = false;
        }
    });
    
    // Interest search and suggestions
    const searchInput = document.getElementById('interest-search');
    const suggestionsBox = document.getElementById('interest-suggestions');
    const selectedContainer = document.getElementById('selected-interests');
    
    searchInput.addEventListener('input', function() {
        const query = this.value.trim().toLowerCase();
        
        if (query.length === 0) {
            suggestionsBox.classList.add('hidden');
            return;
        }
        
        // Filter interests based on query
        const matches = allInterests.filter(interest => 
            interest.toLowerCase().includes(query) && 
            !selectedInterests.includes(interest)
        );
        
        if (matches.length > 0 || query.length > 0) {
            showSuggestions(matches, query);
        } else {
            suggestionsBox.classList.add('hidden');
        }
    });
    
    function showSuggestions(matches, query) {
        suggestionsBox.innerHTML = '';
        
        // Show matching suggestions
        matches.slice(0, 8).forEach(interest => {
            const div = document.createElement('div');
            div.className = 'px-4 py-3 hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer text-slate-900 dark:text-white text-sm transition-colors border-b border-slate-100 dark:border-slate-700 last:border-0';
            div.textContent = interest;
            div.addEventListener('click', () => addInterest(interest));
            suggestionsBox.appendChild(div);
        });
        
        // Add custom option if query doesn't exactly match any existing interest
        if (query.length >= 2 && !allInterests.some(i => i.toLowerCase() === query)) {
            const customDiv = document.createElement('div');
            customDiv.className = 'px-4 py-3 hover:bg-primary/10 cursor-pointer text-primary text-sm font-semibold transition-colors flex items-center gap-2';
            customDiv.innerHTML = `
                <span class="material-symbols-outlined text-[18px]">add</span>
                <span>Add "${query.charAt(0).toUpperCase() + query.slice(1)}" as custom interest</span>
            `;
            customDiv.addEventListener('click', () => {
                const customInterest = query.charAt(0).toUpperCase() + query.slice(1);
                addInterest(customInterest);
            });
            suggestionsBox.appendChild(customDiv);
        }
        
        suggestionsBox.classList.remove('hidden');
    }
    
    function addInterest(interest) {
        if (selectedInterests.includes(interest)) return;
        
        selectedInterests.push(interest);
        updateSelectedInterests();
        searchInput.value = '';
        suggestionsBox.classList.add('hidden');
    }
    
    function removeInterest(interest) {
        selectedInterests = selectedInterests.filter(i => i !== interest);
        updateSelectedInterests();
    }
    
    function updateSelectedInterests() {
        selectedContainer.innerHTML = '';
        
        if (selectedInterests.length === 0) {
            selectedContainer.innerHTML = '<p class="text-slate-400 text-sm italic py-2">No interests selected yet. Start typing to add...</p>';
        } else {
            selectedInterests.forEach(interest => {
                const tag = document.createElement('div');
                tag.className = 'flex items-center gap-1.5 px-3 py-2 rounded-full bg-primary text-white text-sm font-medium shadow-sm';
                tag.innerHTML = `
                    <span>${interest}</span>
                    <button type="button" class="hover:bg-white/20 rounded-full p-0.5 transition-colors" onclick="removeInterest('${interest}')">
                        <span class="material-symbols-outlined text-[16px]">close</span>
                    </button>
                `;
                selectedContainer.appendChild(tag);
            });
        }
        
        // Update hidden input
        document.getElementById('interests-data').value = JSON.stringify(selectedInterests);
    }
    
    // Make removeInterest available globally
    window.removeInterest = removeInterest;
    
    // Close suggestions when clicking outside
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
            suggestionsBox.classList.add('hidden');
        }
    });
    
    // Initialize with empty state
    updateSelectedInterests();
    
    // Common interests quick select
    document.querySelectorAll('.common-interest-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const interest = this.getAttribute('data-interest');
            if (!selectedInterests.includes(interest)) {
                addInterest(interest);
            }
        });
    });
    
    // Update common interest buttons state
    function updateCommonInterestButtons() {
        document.querySelectorAll('.common-interest-btn').forEach(btn => {
            const interest = btn.getAttribute('data-interest');
            if (selectedInterests.includes(interest)) {
                btn.classList.add('bg-primary/10', 'border-primary', 'text-primary');
                btn.classList.remove('bg-white', 'dark:bg-slate-800', 'text-slate-600', 'dark:text-slate-400');
            } else {
                btn.classList.remove('bg-primary/10', 'border-primary', 'text-primary');
                btn.classList.add('bg-white', 'dark:bg-slate-800', 'text-slate-600', 'dark:text-slate-400');
            }
        });
    }
    
    // Override updateSelectedInterests to also update common buttons
    const originalUpdate = updateSelectedInterests;
    updateSelectedInterests = function() {
        originalUpdate();
        updateCommonInterestButtons();
    };
    
    // Form submission
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const countryCode = document.getElementById('country-code').value;
        const phoneNumber = document.getElementById('phone').value;
        const phone = phoneNumber ? `${countryCode}${phoneNumber}` : '';
        const location = document.getElementById('location').value;
        const interests = selectedInterests;
        
        if (!name || !email || !password) {
            showMessage('Please fill in all required fields', 'error');
            return;
        }
        
        if (interests.length === 0) {
            showMessage('Please select at least one interest', 'error');
            return;
        }
        
        // Show loading state
        const btn = document.getElementById('signup-btn');
        const btnText = document.getElementById('btn-text');
        const btnIcon = document.getElementById('btn-icon');
        const btnLoading = document.getElementById('btn-loading');
        
        btn.disabled = true;
        btnText.textContent = 'Creating Account...';
        btnIcon.classList.add('hidden');
        btnLoading.classList.remove('hidden');
        
        try {
            // Create user with Firebase
            const userCredential = await window.firebaseCreateUserWithEmailAndPassword(
                window.firebaseAuth, email, password
            );
            
            const idToken = await userCredential.user.getIdToken();
            
            // Send user data to backend
            const response = await fetch('/auth/signup', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    idToken,
                    name,
                    email,
                    phone,
                    location,
                    interests
                })
            });
            
            if (response.ok) {
                showMessage('Account created successfully! Redirecting...', 'success');
                btnText.textContent = 'Success!';
                setTimeout(() => {
                    window.location.href = '/dashboard';
                }, 1000);
            } else {
                const data = await response.json();
                showMessage(data.error || 'Signup failed. Please try again.', 'error');
                // Reset button state
                btn.disabled = false;
                btnText.textContent = 'Create Account';
                btnIcon.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            }
        } catch (error) {
            showMessage(error.message, 'error');
            // Reset button state
            btn.disabled = false;
            btnText.textContent = 'Create Account';
            btnIcon.classList.remove('hidden');
            btnLoading.classList.add('hidden');
        }
    });
    
    function showMessage(message, type) {
        const container = document.getElementById('flash-messages');
        const alertClass = type === 'error' ? 'bg-red-100 text-red-800 border-red-200' : 'bg-green-100 text-green-800 border-green-200';
        container.innerHTML = `
            <div class="${alertClass} px-4 py-3 rounded-lg border text-sm mb-4">
                ${message}
            </div>
        `;
        if (type === 'success') {
            setTimeout(() => container.innerHTML = '', 3000);
        }
    }
</script>
{% endblock %}
